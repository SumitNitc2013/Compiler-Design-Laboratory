START
MOV BP, 513
MOV SP, 517
CALL Initialize
CALL main
HALT
insert:
PUSH BP
MOV BP, SP
MOV R0, 1
MOV R1, SP
ADD R1, R0 
MOV SP, R1
MOV R0, 1
MOV R1, BP
ADD R0, R1
PUSH R0
PUSH R1
CALL Allocate
POP R1
POP R0
MOV [R0], R1
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, [R0]
MOV R0, 0
ADD R0, R1
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
MOV R0, -4
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R0, [R0]
MOV R1, 516
MOV R1, [R1]
EQ R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L1
MOV R0, -4
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, [R0]
MOV R0, 1
ADD R0, R1
MOV R1, 516
MOV R1, [R1]
MOV [R0], R1
JMP L2
L1:
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, [R0]
MOV R0, 1
ADD R0, R1
MOV R1, -4
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R1, [R1]
MOV [R0], R1
MOV R0, -4
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
L2:
MOV R0, 0
MOV R1, -2
MOV R2, BP
ADD R1, R2
MOV [R1], R0
MOV R0, 1
MOV R1, SP
SUB R1, R0 
MOV SP, R1
POP BP
RET
print:
PUSH BP
MOV BP, SP
MOV R0, 1
MOV R1, SP
ADD R1, R0 
MOV SP, R1
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
L3:
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, 516
MOV R1, [R1]
NE R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L4
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, [R0]
MOV R0, 0
ADD R0, R1
MOV R0, [R0]
OUT R0
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R2, [R1]
MOV R1, 1
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
JMP L3
L4:
MOV R0, 0
MOV R1, -2
MOV R2, BP
ADD R1, R2
MOV [R1], R0
MOV R0, 1
MOV R1, SP
SUB R1, R0 
MOV SP, R1
POP BP
RET
Reverse:
PUSH BP
MOV BP, SP
MOV R0, 2
MOV R1, SP
ADD R1, R0 
MOV SP, R1
MOV R0, -3
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R0, [R0]
MOV R1, 516
MOV R1, [R1]
NE R0, R1
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, [R1]
MOV R1, 1
ADD R1, R2
MOV R1, [R1]
MOV R2, 516
MOV R2, [R2]
NE R1, R2
MUL R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L5
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, [R1]
MOV R1, 1
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
MOV R0, 2
MOV R1, BP
ADD R0, R1
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, [R1]
MOV R1, 1
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
MOV R0, -3
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, [R0]
MOV R0, 1
ADD R0, R1
MOV R1, 516
MOV R1, [R1]
MOV [R0], R1
MOV R0, 513
PUSH R0
MOV R0, 1
MOV R1, BP
ADD R0, R1
PUSH R0
PUSH R1
CALL Reverse
POP R1
POP R0
POP R0
MOV [R0], R1
MOV R0, 2
MOV R1, BP
ADD R0, R1
MOV R1, [R0]
MOV R0, 1
ADD R0, R1
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R1, [R1]
MOV [R0], R1
MOV R0, -3
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV [R0], R1
L5:
MOV R0, 1
MOV R1, -2
MOV R2, BP
ADD R1, R2
MOV [R1], R0
MOV R0, 2
MOV R1, SP
SUB R1, R0 
MOV SP, R1
POP BP
RET
main:
PUSH BP
MOV BP, SP
MOV R0, 3
MOV R1, SP
ADD R1, R0 
MOV SP, R1
MOV R0, 516
MOV R1, 0
MOV R2, 1
SUB R1, R2
MOV [R0], R1
MOV R0, 515
MOV R1, 516
MOV R1, [R1]
MOV [R0], R1
MOV R0, 2
MOV R1, BP
ADD R0, R1
MOV R1, 1
MOV [R0], R1
L6:
MOV R0, 2
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, 1
EQ R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L7
MOV R0, 514
IN R1
MOV [R0], R1
MOV R0, 514
MOV R0, [R0]
MOV R1, 1
EQ R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L8
MOV R0, 1
MOV R1, BP
ADD R0, R1
IN R1
MOV [R0], R1
MOV R0, 513
PUSH R0
MOV R0, 515
PUSH R0
MOV R0, 1
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
PUSH R0
PUSH R1
CALL insert
POP R1
POP R0
POP R0
POP R0
MOV [R0], R1
JMP L9
L8:
MOV R0, 514
MOV R0, [R0]
MOV R1, 2
EQ R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L10
MOV R0, 11111
OUT R0
MOV R0, 513
PUSH R0
MOV R0, 515
MOV R0, [R0]
PUSH R0
PUSH R1
CALL print
POP R1
POP R0
POP R0
MOV [R0], R1
MOV R0, 11111
OUT R0
JMP L11
L10:
MOV R0, 514
MOV R0, [R0]
MOV R1, 3
EQ R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L12
MOV R0, 513
PUSH R0
MOV R0, 515
PUSH R0
PUSH R1
CALL Reverse
POP R1
POP R0
POP R0
MOV [R0], R1
JMP L13
L12:
MOV R0, 2
MOV R1, BP
ADD R0, R1
MOV R1, 0
MOV [R0], R1
L13:
L11:
L9:
JMP L6
L7:
MOV R0, 9
MOV R1, -2
MOV R2, BP
ADD R1, R2
MOV [R1], R0
MOV R0, 3
MOV R1, SP
SUB R1, R0 
MOV SP, R1
POP BP
RET
Initialize:
PUSH BP
MOV BP, SP
MOV R0, 7
MOV [R0], 8
MOV R0, 15
MOV [R0], 16
MOV R0, 23
MOV [R0], 24
MOV R0, 31
MOV [R0], 32
MOV R0, 39
MOV [R0], 40
MOV R0, 47
MOV [R0], 48
MOV R0, 55
MOV [R0], 56
MOV R0, 63
MOV [R0], 64
MOV R0, 71
MOV [R0], 72
MOV R0, 79
MOV [R0], 80
MOV R0, 87
MOV [R0], 88
MOV R0, 95
MOV [R0], 96
MOV R0, 103
MOV [R0], 104
MOV R0, 111
MOV [R0], 112
MOV R0, 119
MOV [R0], 120
MOV R0, 127
MOV [R0], 128
MOV R0, 135
MOV [R0], 136
MOV R0, 143
MOV [R0], 144
MOV R0, 151
MOV [R0], 152
MOV R0, 159
MOV [R0], 160
MOV R0, 167
MOV [R0], 168
MOV R0, 175
MOV [R0], 176
MOV R0, 183
MOV [R0], 184
MOV R0, 191
MOV [R0], 192
MOV R0, 199
MOV [R0], 200
MOV R0, 207
MOV [R0], 208
MOV R0, 215
MOV [R0], 216
MOV R0, 223
MOV [R0], 224
MOV R0, 231
MOV [R0], 232
MOV R0, 239
MOV [R0], 240
MOV R0, 247
MOV [R0], 248
MOV R0, 255
MOV [R0], 256
MOV R0, 263
MOV [R0], 264
MOV R0, 271
MOV [R0], 272
MOV R0, 279
MOV [R0], 280
MOV R0, 287
MOV [R0], 288
MOV R0, 295
MOV [R0], 296
MOV R0, 303
MOV [R0], 304
MOV R0, 311
MOV [R0], 312
MOV R0, 319
MOV [R0], 320
MOV R0, 327
MOV [R0], 328
MOV R0, 335
MOV [R0], 336
MOV R0, 343
MOV [R0], 344
MOV R0, 351
MOV [R0], 352
MOV R0, 359
MOV [R0], 360
MOV R0, 367
MOV [R0], 368
MOV R0, 375
MOV [R0], 376
MOV R0, 383
MOV [R0], 384
MOV R0, 391
MOV [R0], 392
MOV R0, 399
MOV [R0], 400
MOV R0, 407
MOV [R0], 408
MOV R0, 415
MOV [R0], 416
MOV R0, 423
MOV [R0], 424
MOV R0, 431
MOV [R0], 432
MOV R0, 439
MOV [R0], 440
MOV R0, 447
MOV [R0], 448
MOV R0, 455
MOV [R0], 456
MOV R0, 463
MOV [R0], 464
MOV R0, 471
MOV [R0], 472
MOV R0, 479
MOV [R0], 480
MOV R0, 487
MOV [R0], 488
MOV R0, 495
MOV [R0], 496
MOV R0, 503
MOV [R0], 504
MOV R0, -1
MOV [511], R0
MOV R0, 0
MOV [512], R0
POP BP
RET
Allocate:
PUSH BP
MOV BP, SP
MOV R0, [512]
MOV R1, [512]
MOV R2, 7
ADD R1, R2
MOV R1, [R1]
MOV [512], R1
MOV R1, -2
MOV R2, BP
ADD R1, R2
MOV [R1], R0
POP BP
RET
Free:
PUSH BP
MOV BP, SP
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R0, [R1]
MOV R1, R0
MOV R2, 7
ADD R1, R2
MOV [R1], [512]
MOV [512], R0
MOV R0, -2
MOV R1, BP
ADD R0, R1
MOV [R0], R0
POP BP
RET
