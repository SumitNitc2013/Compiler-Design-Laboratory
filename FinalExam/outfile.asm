START
MOV BP, 513
MOV SP, 513
CALL Initialize
CALL main
HALT
readq:
PUSH BP
MOV BP, SP
MOV R0, BP
MOV R1, 1
ADD R0, R1
MOV [R0], -1
MOV R0, BP
MOV R1, 2
ADD R0, R1
MOV [R0], -1
MOV R0, BP
MOV R1, 3
ADD R0, R1
MOV [R0], -1
MOV R0, 3
MOV R1, SP
ADD R1, R0 
MOV SP, R1
MOV R0, 2
MOV R1, BP
ADD R0, R1
IN R1
MOV [R0], R1
MOV R0, 3
MOV R1, BP
ADD R0, R1
MOV R1, 0
MOV [R0], R1
L1:
MOV R0, 3
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R1, 2
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
LT R0, R1
MOV R1, 0
NE R0, R1
JZ R0, L2
MOV R0, 1
MOV R1, BP
ADD R0, R1
IN R1
MOV [R0], R1
MOV R0, -3
MOV R1, BP
ADD R0, R1
MOV R0, [R0]
MOV R0, [R0]
MOV R1, -1
EQ R0, R1
JZ R0, L3
PUSH R0
CALL Allocate
POP R0
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV [R1], R0
L3:
MOV R1, -3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R1, [R1]
MOV R2, 13
ADD R2, R1
MOV R2, [R2]
MOV R3, -1
EQ R2, R3
JZ R2, L4
MOV R2, 13
ADD R2, R1
MOV [R2], 0
L4:
MOV R2, 14
ADD R2, R1
MOV R3, [R2]
INR R3
MOV [R2], R3
MOV R2, 14
ADD R2, R1
MOV R2, [R2]
ADD R2, R1
MOV R1, R2
MOV R2, 1
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV [R1], R2
MOV R1, 3
MOV R2, BP
ADD R1, R2
MOV R2, 3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R3, 1
ADD R2, R3
MOV [R1], R2
JMP L1
L2:
MOV R1, 1
MOV R2, -2
MOV R3, BP
ADD R2, R3
MOV [R2], R1
MOV R1, 3
MOV R2, SP
SUB R2, R1 
MOV SP, R2
POP BP
RET
printq:
PUSH BP
MOV BP, SP
MOV R1, BP
MOV R2, 1
ADD R1, R2
MOV [R1], -1
MOV R1, 1
MOV R2, SP
ADD R2, R1 
MOV SP, R2
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, -1
EQ R2, R3
JNZ R2, L5
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R2, R3
MOV R3, -1
EQ R2, R3
JNZ R2, L5
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R4, 14
ADD R4, R2
MOV R4, [R4]
GT R3, R4
JNZ R3, L5
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R4, [R3]
ADD R4, R2
MOV R4, [R4]
MOV R2, R4
MOV R3, -3
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
INR R4
MOV R5, 13
ADD R5, R3
MOV [R5], R4
JMP L6
L5:
MOV R2, 0
L6:
MOV [R1], R2
L7:
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, 0
NE R1, R2
MOV R2, 0
NE R1, R2
JZ R1, L8
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
OUT R1
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, -1
EQ R2, R3
JNZ R2, L9
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R2, R3
MOV R3, -1
EQ R2, R3
JNZ R2, L9
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R4, 14
ADD R4, R2
MOV R4, [R4]
GT R3, R4
JNZ R3, L9
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R4, [R3]
ADD R4, R2
MOV R4, [R4]
MOV R2, R4
MOV R3, -3
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
INR R4
MOV R5, 13
ADD R5, R3
MOV [R5], R4
JMP L10
L9:
MOV R2, 0
L10:
MOV [R1], R2
JMP L7
L8:
MOV R1, 1
MOV R2, -2
MOV R3, BP
ADD R2, R3
MOV [R2], R1
MOV R1, 1
MOV R2, SP
SUB R2, R1 
MOV SP, R2
POP BP
RET
merge:
PUSH BP
MOV BP, SP
MOV R1, BP
MOV R2, 1
ADD R1, R2
MOV [R1], -1
MOV R1, BP
MOV R2, 2
ADD R1, R2
MOV [R1], -1
MOV R1, BP
MOV R2, 3
ADD R1, R2
MOV [R1], -1
MOV R1, BP
MOV R2, 4
ADD R1, R2
MOV [R1], -1
MOV R1, BP
MOV R2, 5
ADD R1, R2
MOV [R1], -1
MOV R1, 5
MOV R2, SP
ADD R2, R1 
MOV SP, R2
MOV R1, 2
MOV R2, BP
ADD R1, R2
MOV R2, 1
MOV [R1], R2
MOV R1, 3
MOV R2, BP
ADD R1, R2
MOV R2, 0
MOV [R1], R2
MOV R1, 4
MOV R2, BP
ADD R1, R2
MOV R2, 0
MOV [R1], R2
L11:
MOV R1, 3
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, 1
NE R1, R2
MOV R2, 4
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R3, 1
NE R2, R3
MUL R1, R2
MOV R2, 0
NE R1, R2
JZ R1, L12
MOV R1, 2
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, 1
EQ R1, R2
MOV R2, 0
NE R1, R2
JZ R1, L13
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, -1
EQ R2, R3
JNZ R2, L14
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R2, R3
MOV R3, -1
EQ R2, R3
JNZ R2, L14
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R4, 14
ADD R4, R2
MOV R4, [R4]
GT R3, R4
JNZ R3, L14
MOV R2, -3
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R4, [R3]
ADD R4, R2
MOV R4, [R4]
MOV R2, R4
MOV R3, -3
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
INR R4
MOV R5, 13
ADD R5, R3
MOV [R5], R4
JMP L15
L14:
MOV R2, 0
L15:
MOV [R1], R2
MOV R1, 1
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, 0
NE R1, R2
MOV R2, 0
NE R1, R2
JZ R1, L16
MOV R1, 5
MOV R2, BP
ADD R1, R2
MOV R1, [R1]
MOV R2, -1
EQ R1, R2
JZ R1, L18
PUSH R0
PUSH R1
CALL Allocate
POP R1
POP R0
MOV R2, 5
MOV R3, BP
ADD R2, R3
MOV [R2], R1
L18:
MOV R2, 5
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R3, 13
ADD R3, R2
MOV R3, [R3]
MOV R4, -1
EQ R3, R4
JZ R3, L19
MOV R3, 13
ADD R3, R2
MOV [R3], 0
L19:
MOV R3, 14
ADD R3, R2
MOV R4, [R3]
INR R4
MOV [R3], R4
MOV R3, 14
ADD R3, R2
MOV R3, [R3]
ADD R3, R2
MOV R2, R3
MOV R3, 1
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV [R2], R3
JMP L17
L16:
MOV R2, 3
MOV R3, BP
ADD R2, R3
MOV R3, 1
MOV [R2], R3
L17:
MOV R2, 2
MOV R3, BP
ADD R2, R3
MOV R3, 2
MOV [R2], R3
L13:
MOV R2, 2
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R3, 2
EQ R2, R3
MOV R3, 0
NE R2, R3
JZ R2, L20
MOV R2, 1
MOV R3, BP
ADD R2, R3
MOV R3, -4
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, -1
EQ R3, R4
JNZ R3, L21
MOV R3, -4
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
MOV R3, R4
MOV R4, -1
EQ R3, R4
JNZ R3, L21
MOV R3, -4
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
MOV R5, 14
ADD R5, R3
MOV R5, [R5]
GT R4, R5
JNZ R4, L21
MOV R3, -4
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R5, [R4]
ADD R5, R3
MOV R5, [R5]
MOV R3, R5
MOV R4, -4
MOV R5, BP
ADD R4, R5
MOV R4, [R4]
MOV R4, [R4]
MOV R5, 13
ADD R5, R4
MOV R5, [R5]
INR R5
MOV R6, 13
ADD R6, R4
MOV [R6], R5
JMP L22
L21:
MOV R3, 0
L22:
MOV [R2], R3
MOV R2, 1
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R3, 0
NE R2, R3
MOV R3, 0
NE R2, R3
JZ R2, L23
MOV R2, 5
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
MOV R3, -1
EQ R2, R3
JZ R2, L25
PUSH R1
PUSH R0
PUSH R2
CALL Allocate
POP R2
POP R0
POP R1
MOV R3, 5
MOV R4, BP
ADD R3, R4
MOV [R3], R2
L25:
MOV R3, 5
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
MOV R5, -1
EQ R4, R5
JZ R4, L26
MOV R4, 13
ADD R4, R3
MOV [R4], 0
L26:
MOV R4, 14
ADD R4, R3
MOV R5, [R4]
INR R5
MOV [R4], R5
MOV R4, 14
ADD R4, R3
MOV R4, [R4]
ADD R4, R3
MOV R3, R4
MOV R4, 1
MOV R5, BP
ADD R4, R5
MOV R4, [R4]
MOV [R3], R4
JMP L24
L23:
MOV R3, 4
MOV R4, BP
ADD R3, R4
MOV R4, 1
MOV [R3], R4
L24:
MOV R3, 2
MOV R4, BP
ADD R3, R4
MOV R4, 1
MOV [R3], R4
L20:
JMP L11
L12:
MOV R3, 5
MOV R4, BP
ADD R3, R4
MOV R3, [R3]
MOV R4, -2
MOV R5, BP
ADD R4, R5
MOV [R4], R3
MOV R3, 5
MOV R4, SP
SUB R4, R3 
MOV SP, R4
POP BP
RET
main:
PUSH BP
MOV BP, SP
MOV R3, BP
MOV R4, 1
ADD R3, R4
MOV [R3], -1
MOV R3, BP
MOV R4, 2
ADD R3, R4
MOV [R3], -1
MOV R3, BP
MOV R4, 3
ADD R3, R4
MOV [R3], -1
MOV R3, BP
MOV R4, 4
ADD R3, R4
MOV [R3], -1
MOV R3, 4
MOV R4, SP
ADD R4, R3 
MOV SP, R4
MOV R3, 1
MOV R4, BP
ADD R3, R4
PUSH R3
PUSH R2
PUSH R1
PUSH R0
MOV R0, 2
MOV R1, BP
ADD R0, R1
PUSH R0
PUSH R4
CALL readq
POP R4
POP R0
POP R0
POP R1
POP R2
POP R3
MOV [R3], R4
MOV R3, 1
MOV R4, BP
ADD R3, R4
PUSH R3
PUSH R2
PUSH R1
PUSH R0
MOV R0, 3
MOV R1, BP
ADD R0, R1
PUSH R0
PUSH R4
CALL readq
POP R4
POP R0
POP R0
POP R1
POP R2
POP R3
MOV [R3], R4
MOV R3, 4
MOV R4, BP
ADD R3, R4
PUSH R3
PUSH R2
PUSH R1
PUSH R0
MOV R0, 2
MOV R1, BP
ADD R0, R1
PUSH R0
MOV R0, 3
MOV R1, BP
ADD R0, R1
PUSH R0
PUSH R4
CALL merge
POP R4
POP R0
POP R0
POP R0
POP R1
POP R2
POP R3
MOV [R3], R4
MOV R3, 1
MOV R4, BP
ADD R3, R4
PUSH R3
PUSH R2
PUSH R1
PUSH R0
MOV R0, 4
MOV R1, BP
ADD R0, R1
PUSH R0
PUSH R4
CALL printq
POP R4
POP R0
POP R0
POP R1
POP R2
POP R3
MOV [R3], R4
MOV R3, 0
MOV R4, -2
MOV R5, BP
ADD R4, R5
MOV [R4], R3
MOV R3, 4
MOV R4, SP
SUB R4, R3 
MOV SP, R4
POP BP
RET
Initialize:
PUSH BP
MOV BP, SP
MOV R3, 13
MOV [R3], -1
MOV R3, 14
MOV [R3], -1
MOV R3, 15
MOV [R3], 16
MOV R3, 29
MOV [R3], -1
MOV R3, 30
MOV [R3], -1
MOV R3, 31
MOV [R3], 32
MOV R3, 45
MOV [R3], -1
MOV R3, 46
MOV [R3], -1
MOV R3, 47
MOV [R3], 48
MOV R3, 61
MOV [R3], -1
MOV R3, 62
MOV [R3], -1
MOV R3, 63
MOV [R3], 64
MOV R3, 77
MOV [R3], -1
MOV R3, 78
MOV [R3], -1
MOV R3, 79
MOV [R3], 80
MOV R3, 93
MOV [R3], -1
MOV R3, 94
MOV [R3], -1
MOV R3, 95
MOV [R3], 96
MOV R3, 109
MOV [R3], -1
MOV R3, 110
MOV [R3], -1
MOV R3, 111
MOV [R3], 112
MOV R3, 125
MOV [R3], -1
MOV R3, 126
MOV [R3], -1
MOV R3, 127
MOV [R3], 128
MOV R3, 141
MOV [R3], -1
MOV R3, 142
MOV [R3], -1
MOV R3, 143
MOV [R3], 144
MOV R3, 157
MOV [R3], -1
MOV R3, 158
MOV [R3], -1
MOV R3, 159
MOV [R3], 160
MOV R3, 173
MOV [R3], -1
MOV R3, 174
MOV [R3], -1
MOV R3, 175
MOV [R3], 176
MOV R3, 189
MOV [R3], -1
MOV R3, 190
MOV [R3], -1
MOV R3, 191
MOV [R3], 192
MOV R3, 205
MOV [R3], -1
MOV R3, 206
MOV [R3], -1
MOV R3, 207
MOV [R3], 208
MOV R3, 221
MOV [R3], -1
MOV R3, 222
MOV [R3], -1
MOV R3, 223
MOV [R3], 224
MOV R3, 237
MOV [R3], -1
MOV R3, 238
MOV [R3], -1
MOV R3, 239
MOV [R3], 240
MOV R3, 253
MOV [R3], -1
MOV R3, 254
MOV [R3], -1
MOV R3, 255
MOV [R3], 256
MOV R3, 269
MOV [R3], -1
MOV R3, 270
MOV [R3], -1
MOV R3, 271
MOV [R3], 272
MOV R3, 285
MOV [R3], -1
MOV R3, 286
MOV [R3], -1
MOV R3, 287
MOV [R3], 288
MOV R3, 301
MOV [R3], -1
MOV R3, 302
MOV [R3], -1
MOV R3, 303
MOV [R3], 304
MOV R3, 317
MOV [R3], -1
MOV R3, 318
MOV [R3], -1
MOV R3, 319
MOV [R3], 320
MOV R3, 333
MOV [R3], -1
MOV R3, 334
MOV [R3], -1
MOV R3, 335
MOV [R3], 336
MOV R3, 349
MOV [R3], -1
MOV R3, 350
MOV [R3], -1
MOV R3, 351
MOV [R3], 352
MOV R3, 365
MOV [R3], -1
MOV R3, 366
MOV [R3], -1
MOV R3, 367
MOV [R3], 368
MOV R3, 381
MOV [R3], -1
MOV R3, 382
MOV [R3], -1
MOV R3, 383
MOV [R3], 384
MOV R3, 397
MOV [R3], -1
MOV R3, 398
MOV [R3], -1
MOV R3, 399
MOV [R3], 400
MOV R3, 413
MOV [R3], -1
MOV R3, 414
MOV [R3], -1
MOV R3, 415
MOV [R3], 416
MOV R3, 429
MOV [R3], -1
MOV R3, 430
MOV [R3], -1
MOV R3, 431
MOV [R3], 432
MOV R3, 445
MOV [R3], -1
MOV R3, 446
MOV [R3], -1
MOV R3, 447
MOV [R3], 448
MOV R3, 461
MOV [R3], -1
MOV R3, 462
MOV [R3], -1
MOV R3, 463
MOV [R3], 464
MOV R3, 477
MOV [R3], -1
MOV R3, 478
MOV [R3], -1
MOV R3, 479
MOV [R3], 480
MOV R3, 493
MOV [R3], -1
MOV R3, 494
MOV [R3], -1
MOV R3, 495
MOV [R3], 496
MOV R3, 509
MOV [R3], -1
MOV R3, 510
MOV [R3], -1
MOV R3, 511
MOV [R3], 512
MOV R3, -1
MOV [511], R3
MOV R3, 0
MOV [512], R3
POP BP
RET
Allocate:
PUSH BP
MOV BP, SP
MOV R3, [512]
MOV R4, [512]
MOV R5, 15
ADD R4, R5
MOV R4, [R4]
MOV [512], R4
MOV R4, -2
MOV R5, BP
ADD R4, R5
MOV [R4], R3
POP BP
RET
Free:
PUSH BP
MOV BP, SP
MOV R4, -3
MOV R5, BP
ADD R4, R5
MOV R3, [R4]
MOV R4, R3
MOV R5, 15
ADD R4, R5
MOV [R4], [512]
MOV [512], R3
MOV R3, -2
MOV R4, BP
ADD R3, R4
MOV [R3], R0
POP BP
RET
