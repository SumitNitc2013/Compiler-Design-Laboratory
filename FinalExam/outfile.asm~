START
MOV BP, 513
MOV R0, 513
MOV [R0], -1
MOV SP, 514
CALL Initialize
CALL main
HALT
main:
PUSH BP
MOV BP, SP
MOV R0, BP
MOV R1, 1
ADD R0, R1
MOV [R0], -1
MOV R0, 1
MOV R1, SP
ADD R1, R0 
MOV SP, R1
MOV R0, 513
MOV R0, [R0]
MOV R1, -1
EQ R0, R1
JZ R0, L1
PUSH R0
PUSH R1
CALL Allocate
POP R1
POP R0
MOV R2, 513
MOV [R2], R1
L1:
MOV R1, 513
MOV R1, [R1]
MOV R2, 13
ADD R2, R1
MOV R2, [R2]
MOV R3, -1
EQ R2, R3
JZ R2, L2
MOV R2, 13
ADD R2, R1
MOV [R2], 0
L2:
MOV R2, 14
ADD R2, R1
MOV R3, [R2]
INR R3
MOV [R2], R3
MOV R2, 14
ADD R2, R1
MOV R3, [R2]
ADD R3, R1
MOV R4, 45
MOV [R3], R4
MOV R2, 1
MOV R3, BP
ADD R2, R3
MOV R3, 513
MOV R3, [R3]
MOV R4, -1
EQ R3, R4
JNZ R3, L3
MOV R3, 513
MOV R3, [R3]
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
MOV R5, -1
EQ R4, R5
JNZ R4, L3
MOV R4, 13
ADD R4, R3
MOV R4, [R4]
MOV R5, 14
ADD R5, R3
MOV R5, [R5]
GT R4, R5
JNZ R4, L3
MOV R4, 13
ADD R4, R3
MOV R5, [R4]
ADD R5, R3
MOV R5, [R5]
MOV R4, 13
ADD R4, R3
MOV R6, [R4]
INR R6
MOV [R4], R6
MOV R3, R5
JMP L4
L3:
MOV R3, 0
L4:
MOV [R2], R3
MOV R2, 1
MOV R3, BP
ADD R2, R3
MOV R2, [R2]
OUT R2
MOV R2, 0
MOV R3, -2
MOV R4, BP
ADD R3, R4
MOV [R3], R2
MOV R2, 1
MOV R3, SP
SUB R3, R2 
MOV SP, R3
POP BP
RET
Initialize:
PUSH BP
MOV BP, SP
MOV R2, 13
MOV [R2], -1
MOV R2, 14
MOV [R2], -1
MOV R2, 15
MOV [R2], 16
MOV R2, 29
MOV [R2], -1
MOV R2, 30
MOV [R2], -1
MOV R2, 31
MOV [R2], 32
MOV R2, 45
MOV [R2], -1
MOV R2, 46
MOV [R2], -1
MOV R2, 47
MOV [R2], 48
MOV R2, 61
MOV [R2], -1
MOV R2, 62
MOV [R2], -1
MOV R2, 63
MOV [R2], 64
MOV R2, 77
MOV [R2], -1
MOV R2, 78
MOV [R2], -1
MOV R2, 79
MOV [R2], 80
MOV R2, 93
MOV [R2], -1
MOV R2, 94
MOV [R2], -1
MOV R2, 95
MOV [R2], 96
MOV R2, 109
MOV [R2], -1
MOV R2, 110
MOV [R2], -1
MOV R2, 111
MOV [R2], 112
MOV R2, 125
MOV [R2], -1
MOV R2, 126
MOV [R2], -1
MOV R2, 127
MOV [R2], 128
MOV R2, 141
MOV [R2], -1
MOV R2, 142
MOV [R2], -1
MOV R2, 143
MOV [R2], 144
MOV R2, 157
MOV [R2], -1
MOV R2, 158
MOV [R2], -1
MOV R2, 159
MOV [R2], 160
MOV R2, 173
MOV [R2], -1
MOV R2, 174
MOV [R2], -1
MOV R2, 175
MOV [R2], 176
MOV R2, 189
MOV [R2], -1
MOV R2, 190
MOV [R2], -1
MOV R2, 191
MOV [R2], 192
MOV R2, 205
MOV [R2], -1
MOV R2, 206
MOV [R2], -1
MOV R2, 207
MOV [R2], 208
MOV R2, 221
MOV [R2], -1
MOV R2, 222
MOV [R2], -1
MOV R2, 223
MOV [R2], 224
MOV R2, 237
MOV [R2], -1
MOV R2, 238
MOV [R2], -1
MOV R2, 239
MOV [R2], 240
MOV R2, 253
MOV [R2], -1
MOV R2, 254
MOV [R2], -1
MOV R2, 255
MOV [R2], 256
MOV R2, 269
MOV [R2], -1
MOV R2, 270
MOV [R2], -1
MOV R2, 271
MOV [R2], 272
MOV R2, 285
MOV [R2], -1
MOV R2, 286
MOV [R2], -1
MOV R2, 287
MOV [R2], 288
MOV R2, 301
MOV [R2], -1
MOV R2, 302
MOV [R2], -1
MOV R2, 303
MOV [R2], 304
MOV R2, 317
MOV [R2], -1
MOV R2, 318
MOV [R2], -1
MOV R2, 319
MOV [R2], 320
MOV R2, 333
MOV [R2], -1
MOV R2, 334
MOV [R2], -1
MOV R2, 335
MOV [R2], 336
MOV R2, 349
MOV [R2], -1
MOV R2, 350
MOV [R2], -1
MOV R2, 351
MOV [R2], 352
MOV R2, 365
MOV [R2], -1
MOV R2, 366
MOV [R2], -1
MOV R2, 367
MOV [R2], 368
MOV R2, 381
MOV [R2], -1
MOV R2, 382
MOV [R2], -1
MOV R2, 383
MOV [R2], 384
MOV R2, 397
MOV [R2], -1
MOV R2, 398
MOV [R2], -1
MOV R2, 399
MOV [R2], 400
MOV R2, 413
MOV [R2], -1
MOV R2, 414
MOV [R2], -1
MOV R2, 415
MOV [R2], 416
MOV R2, 429
MOV [R2], -1
MOV R2, 430
MOV [R2], -1
MOV R2, 431
MOV [R2], 432
MOV R2, 445
MOV [R2], -1
MOV R2, 446
MOV [R2], -1
MOV R2, 447
MOV [R2], 448
MOV R2, 461
MOV [R2], -1
MOV R2, 462
MOV [R2], -1
MOV R2, 463
MOV [R2], 464
MOV R2, 477
MOV [R2], -1
MOV R2, 478
MOV [R2], -1
MOV R2, 479
MOV [R2], 480
MOV R2, 493
MOV [R2], -1
MOV R2, 494
MOV [R2], -1
MOV R2, 495
MOV [R2], 496
MOV R2, 509
MOV [R2], -1
MOV R2, 510
MOV [R2], -1
MOV R2, 511
MOV [R2], 512
MOV R2, -1
MOV [511], R2
MOV R2, 0
MOV [512], R2
POP BP
RET
Allocate:
PUSH BP
MOV BP, SP
MOV R2, [512]
MOV R3, [512]
MOV R4, 15
ADD R3, R4
MOV R3, [R3]
MOV [512], R3
MOV R3, -2
MOV R4, BP
ADD R3, R4
MOV [R3], R2
POP BP
RET
Free:
PUSH BP
MOV BP, SP
MOV R3, -3
MOV R4, BP
ADD R3, R4
MOV R2, [R3]
MOV R3, R2
MOV R4, 15
ADD R3, R4
MOV [R3], [512]
MOV [512], R2
MOV R2, -2
MOV R3, BP
ADD R2, R3
MOV [R2], R0
POP BP
RET
